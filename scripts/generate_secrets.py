#!/usr/bin/env python3
"""\nSecrets Generator \u2014 Generates cryptographically secure keys for DeepMind Workspace.\n\nUsage:\n    python scripts/generate_secrets.py              # Generate all keys\n    python scripts/generate_secrets.py --key jwt    # Generate single JWT key\n    python scripts/generate_secrets.py --env        # Output as .env format\n    python scripts/generate_secrets.py --json       # Output as JSON\n\nAll output goes to stderr for safe copy-paste (no accidental piping to files/logs).\n"""\nimport sys\nimport secrets\nimport argparse\nimport json as json_module\nfrom datetime import datetime, timezone\n\n\ndef generate_key(length: int = 64) -> str:\n    \"\"\"Generate a cryptographically secure URL-safe base64 key.\"\"\"\n    return secrets.token_urlsafe(length)\n\n\ndef generate_hex_key(length: int = 64) -> str:\n    \"\"\"Generate a cryptographically secure hex key.\"\"\"\n    return secrets.token_hex(length)\n\n\ndef main():\n    parser = argparse.ArgumentParser(\n        description=\"Generate cryptographically secure secrets for DeepMind Workspace\",\n        formatter_class=argparse.RawDescriptionHelpFormatter,\n        epilog=\"\"\"\nExamples:\n  python scripts/generate_secrets.py           # Show all keys\n  python scripts/generate_secrets.py --env     # Output .env format\n  python scripts/generate_secrets.py --json    # Output JSON format\n  python scripts/generate_secrets.py --key jwt # Single JWT key only\n        \"\"\",\n    )\n    parser.add_argument(\n        \"--key\",\n        choices=[\"all\", \"app\", \"jwt\", \"jwt_refresh\"],\n        default=\"all\",\n        help=\"Which key to generate (default: all)\",\n    )\n    parser.add_argument(\n        \"--env\", action=\"store_true\",\n        help=\"Output in .env file format\",\n    )\n    parser.add_argument(\n        \"--json\", action=\"store_true\",\n        help=\"Output in JSON format\",\n    )\n    parser.add_argument(\n        \"--length\", type=int, default=64,\n        help=\"Key length in bytes before encoding (default: 64)\",\n    )\n\n    args = parser.parse_args()\n\n    # Generate keys\n    keys = {}\n    if args.key in (\"all\", \"app\"):\n        keys[\"APP_SECRET_KEY\"] = generate_key(args.length)\n    if args.key in (\"all\", \"jwt\"):\n        keys[\"JWT_SECRET_KEY\"] = generate_key(args.length)\n    if args.key in (\"all\", \"jwt_refresh\"):\n        keys[\"JWT_REFRESH_SECRET_KEY\"] = generate_key(args.length)\n\n    # Output format\n    if args.json:\n        print(json_module.dumps(keys, indent=2), file=sys.stderr)\n    elif args.env:\n        timestamp = datetime.now(timezone.utc).strftime('%Y-%m-%d %H:%M:%S UTC')\n        print(f\"# Generated by scripts/generate_secrets.py on {timestamp}\", file=sys.stderr)\n        for name, value in keys.items():\n            print(f\"{name}={value}\", file=sys.stderr)\n    else:\n        timestamp = datetime.now(timezone.utc).strftime('%Y-%m-%d %H:%M:%S UTC')\n        print(\"\", file=sys.stderr)\n        print(\"\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\", file=sys.stderr)\n        print(\"\u2551  \ud83d\udd10  DeepMind Workspace \u2014 Secure Key Generator              \u2551\", file=sys.stderr)\n        print(\"\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\", file=sys.stderr)\n        print(f\"\u2551  Generated: {timestamp}\", file=sys.stderr)\n        print(f\"\u2551  Key length: {args.length} bytes\", file=sys.stderr)\n        print(\"\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\", file=sys.stderr)\n\n        for name, value in keys.items():\n            print(f\"\u2551\", file=sys.stderr)\n            print(f\"\u2551  {name}:\", file=sys.stderr)\n            print(f\"\u2551  {value}\", file=sys.stderr)\n\n        print(\"\u2551\", file=sys.stderr)\n        print(\"\u2560\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563\", file=sys.stderr)\n        print(\"\u2551  Copy these values to your .env file.                        \u2551\", file=sys.stderr)\n        print(\"\u2551  NEVER commit secrets to version control.                    \u2551\", file=sys.stderr)\n        print(\"\u2551                                                              \u2551\", file=sys.stderr)\n        print(\"\u2551  Quick copy (--env flag):                                    \u2551\", file=sys.stderr)\n        print(\"\u2551    python scripts/generate_secrets.py --env 2>> .env         \u2551\", file=sys.stderr)\n        print(\"\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\", file=sys.stderr)\n        print(\"\", file=sys.stderr)\n\n\nif __name__ == \"__main__\":\n    main()\n